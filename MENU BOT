#!/bin/bash

# ==========================================
#       MENU BOT TELEGRAM – FINAL
# ==========================================

GREEN="\e[42;30m"
YELLOW="\e[33m"
RED="\e[31m"
NC="\e[0m"

BOT_FILE="/etc/pondokvpn/bot.conf"

# ------------------------
# Fungsi BOT
# ------------------------
masukan_api() {
    read -p "Masukkan BOT TOKEN baru: " newtoken
    echo "BOT_TOKEN=\"$newtoken\"" > $BOT_FILE
    echo -e "${GREEN}BOT TOKEN berhasil disimpan!${NC}"
    read -p "Tekan Enter untuk kembali..."
}

ganti_api() {
    if [ ! -s "$BOT_FILE" ]; then
        echo -e "${RED}Belum ada BOT TOKEN tersimpan!${NC}"
        read -p "Tekan Enter..."
        return
    fi
    read -p "Masukkan BOT TOKEN baru: " newtoken
    sed -i "s|^BOT_TOKEN=.*|BOT_TOKEN=\"$newtoken\"|g" $BOT_FILE
    echo -e "${GREEN}BOT TOKEN berhasil diganti!${NC}"
    read -p "Tekan Enter untuk kembali..."
}

hapus_bot() {
    > $BOT_FILE
    echo -e "${GREEN}BOT TOKEN berhasil dihapus!${NC}"
    read -p "Tekan Enter untuk kembali..."
}

# ------------------------
# Menu BOT RAPI
# ------------------------
menu_bot() {
    while true; do
        clear
        echo -e "${GREEN}===== MENU BOT TELEGRAM =====${NC}"
        echo -e "${GREEN}╔══════════════════════════════════════╗${NC}"
        printf "${GREEN}║%32s║\n${NC}" " ${YELLOW}([${RED}1${YELLOW}])${NC} MASUKAN API TOKEN"
        printf "${GREEN}║%32s║\n${NC}" " ${YELLOW}([${RED}2${YELLOW}])${NC} GANTI API TOKEN"
        printf "${GREEN}║%32s║\n${NC}" " ${YELLOW}([${RED}3${YELLOW}])${NC} HAPUS BOT TOKEN"
        printf "${GREEN}║%32s║\n${NC}" " ${YELLOW}([${RED}0${YELLOW}])${NC} KEMBALI"
        echo -e "${GREEN}╚══════════════════════════════════════╝${NC}"

        # Status BOT
        if [ -s "$BOT_FILE" ]; then
            echo "BOT TOKEN: ${GREEN}Terpasang${NC}"
        else
            echo "BOT TOKEN: ${RED}Kosong${NC}"
        fi
        echo ""

        read -p "Pilih menu: " pil
        case $pil in
            1) masukan_api ;;
            2) ganti_api ;;
            3) hapus_bot ;;
            0) break ;;  # Kembali ke menu utama
            *) echo -e "${RED}Pilihan salah!${NC}" ; read -p "Tekan Enter..." ;;
        esac
    done
}
